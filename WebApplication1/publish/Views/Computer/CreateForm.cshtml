@{ Layout = "~/Views/Shared/_Layout.cshtml"; }

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>电脑信息录入 - 表单方式</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        /* 全局样式 */
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        
        /* 容器样式 */
        .container {
            margin-top: 30px;
            max-width: 900px;
        }
        
        /* 卡片样式 */
        .card {
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        /* 卡片头部样式 */
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-bottom: none;
        }
        
        /* 标题样式 */
        .card-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }
        
        /* 表单容器样式 */
        .card-body {
            background-color: white;
            padding: 30px;
        }
        
        /* 表单组样式 */
        .form-group {
            margin-bottom: 25px;
        }
        
        /* 标签样式 */
        .form-group label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            display: block;
        }
        
        /* 输入框样式 */
        .form-control {
            border-radius: 6px;
            border: 1px solid #e9ecef;
            padding: 12px 16px;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* 按钮样式 */
        .btn {
            border-radius: 6px;
            font-weight: 500;
            padding: 10px 20px;
            transition: all 0.3s ease;
            border: none;
            font-size: 14px;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        /* 按钮组样式 */
        .btn-group {
            margin-top: 20px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        /* 配件列表样式 */
        .parts-container {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        /* 固定配件样式 */
        .part-section {
            background-color: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        /* 配件头部 */
        .part-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .part-header h4 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #343a40;
        }
        
        /* 配件字段容器 */
        .part-fields {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        /* 表单行 */
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        /* 表单列 */
        .form-group.col-md-2, .form-group.col-md-4, .form-group.col-md-6 {
            flex: 1;
            min-width: 150px;
        }
        
        .form-group.col-md-2 {
            flex: 0 0 100px;
        }
        
        .form-group.col-md-4 {
            flex: 0 0 200px;
        }
        
        .form-group.col-md-6 {
            flex: 1 1 300px;
        }
        
        /* 固定配件列表 */
        .fixed-parts {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        /* 加载遮罩 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }
        
        .spinner {
            border: 4px solid rgba(102, 126, 234, 0.1);
            border-left-color: #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @@keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Toast提示样式 */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: none;
            animation: slideInRight 0.3s ease;
        }
        
        @@keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* 表单验证样式 */
        .is-invalid {
            border-color: #dc3545 !important;
        }
        
        .invalid-feedback {
            color: #dc3545;
            font-size: 12px;
            margin-top: 4px;
        }
        
        /* 响应式设计 */
        @@media (max-width: 768px) {
            .card-body {
                padding: 20px;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .part-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .part-row .form-group {
                min-width: auto;
            }
        }
        
        /* 总成本显示 */
        .total-cost {
            background-color: #f8f9ff;
            border: 1px solid #e3e8ff;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
        }
        
        .total-cost-label {
            font-weight: 600;
            color: #667eea;
        }
        
        .total-cost-value {
            font-weight: 700;
            color: #667eea;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <!-- 加载遮罩 -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>
    
    <!-- Toast提示容器 -->
    <div id="toastContainer"></div>
    
    <div class="container">
        <!-- 主卡片 -->
        <div class="card">
            <!-- 卡片头部 -->
            <div class="card-header">
                <div class="d-flex align-items-center">
                    <i class="bi bi-plus-circle me-2"></i>
                    <h2>电脑信息录入 - 表单方式</h2>
                </div>
            </div>
            
            <!-- 卡片主体 -->
            <div class="card-body">
                <form id="computerForm">
                    <!-- 电脑名称 -->
                    <div class="form-group">
                        <label for="ComputerName" class="required">
                            <i class="bi bi-pc-display me-1"></i>
                            电脑名称
                        </label>
                        <input type="text" class="form-control" id="ComputerName" name="ComputerName" 
                               placeholder="请输入电脑名称，例如：游戏主机001" required>
                        <div class="invalid-feedback">请输入电脑名称</div>
                    </div>
                    
                    <!-- 配件列表 -->
                    <div class="form-group">
                        <label>
                            <i class="bi bi-tools me-1"></i>
                            配件列表
                        </label>
                        <div class="parts-container">
                            <!-- 固定配件类型列表 -->
                            <div class="fixed-parts">
                                <!-- 主板 -->
                                <div class="part-section">
                                    <div class="part-header">
                                        <h4>主板</h4>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-motherboard" checked>
                                            <label class="form-check-label" for="enable-motherboard">启用</label>
                                        </div>
                                    </div>
                                    <div class="part-fields">
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label class="required">配件名称</label>
                                                <input type="text" class="form-control" name="motherboard.PartName" 
                                                       placeholder="例如：七彩虹h610m-e" required>
                                                <div class="invalid-feedback">请输入配件名称</div>
                                            </div>
                                            <div class="form-group col-md-4">
                                                <label class="required">配件成本</label>
                                                <input type="number" step="0.01" class="form-control part-cost" name="motherboard.PartCost" 
                                                       placeholder="例如：190" required>
                                                <div class="invalid-feedback">请输入配件成本</div>
                                            </div>
                                            <div class="form-group col-md-2">
                                                <label>配件状态</label>
                                                <select class="form-control" name="motherboard.PartStatus">
                                                    <option value="1">正常</option>
                                                    <option value="2">异常</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label>第三方订单</label>
                                                <input type="text" class="form-control" name="motherboard.ThirdPartyOrder" 
                                                       placeholder="例如：TB123456789">
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label>购买平台</label>
                                                <select class="form-control" name="motherboard.PurchasePlatform">
                                                    <option value="1">咸鱼</option>
                                                    <option value="2">淘宝</option>
                                                    <option value="3">京东</option>
                                                    <option value="4">拼多多</option>
                                                    <option value="5">其他</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- CPU -->
                                <div class="part-section">
                                    <div class="part-header">
                                        <h4>CPU</h4>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-cpu" checked>
                                            <label class="form-check-label" for="enable-cpu">启用</label>
                                        </div>
                                    </div>
                                    <div class="part-fields">
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label class="required">配件名称</label>
                                                <input type="text" class="form-control" name="cpu.PartName" 
                                                       placeholder="例如：i5 12490F" required>
                                                <div class="invalid-feedback">请输入配件名称</div>
                                            </div>
                                            <div class="form-group col-md-4">
                                                <label class="required">配件成本</label>
                                                <input type="number" step="0.01" class="form-control part-cost" name="cpu.PartCost" 
                                                       placeholder="例如：720" required>
                                                <div class="invalid-feedback">请输入配件成本</div>
                                            </div>
                                            <div class="form-group col-md-2">
                                                <label>配件状态</label>
                                                <select class="form-control" name="cpu.PartStatus">
                                                    <option value="1">正常</option>
                                                    <option value="2">异常</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label>第三方订单</label>
                                                <input type="text" class="form-control" name="cpu.ThirdPartyOrder" 
                                                       placeholder="例如：TB123456789">
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label>购买平台</label>
                                                <select class="form-control" name="cpu.PurchasePlatform">
                                                    <option value="1">咸鱼</option>
                                                    <option value="2">淘宝</option>
                                                    <option value="3">京东</option>
                                                    <option value="4">拼多多</option>
                                                    <option value="5">其他</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 内存 -->
                                <div class="part-section">
                                    <div class="part-header">
                                        <h4>内存</h4>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-memory" checked>
                                            <label class="form-check-label" for="enable-memory">启用</label>
                                        </div>
                                    </div>
                                    <div class="part-fields">
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label class="required">配件名称</label>
                                                <input type="text" class="form-control" name="memory.PartName" 
                                                       placeholder="例如：海盗船8*2 3200" required>
                                                <div class="invalid-feedback">请输入配件名称</div>
                                            </div>
                                            <div class="form-group col-md-4">
                                                <label class="required">配件成本</label>
                                                <input type="number" step="0.01" class="form-control part-cost" name="memory.PartCost" 
                                                       placeholder="例如：320" required>
                                                <div class="invalid-feedback">请输入配件成本</div>
                                            </div>
                                            <div class="form-group col-md-2">
                                                <label>配件状态</label>
                                                <select class="form-control" name="memory.PartStatus">
                                                    <option value="1">正常</option>
                                                    <option value="2">异常</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label>第三方订单</label>
                                                <input type="text" class="form-control" name="memory.ThirdPartyOrder" 
                                                       placeholder="例如：TB123456789">
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label>购买平台</label>
                                                <select class="form-control" name="memory.PurchasePlatform">
                                                    <option value="1">咸鱼</option>
                                                    <option value="2">淘宝</option>
                                                    <option value="3">京东</option>
                                                    <option value="4">拼多多</option>
                                                    <option value="5">其他</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 硬盘 -->
                                <div class="part-section">
                                    <div class="part-header">
                                        <h4>硬盘</h4>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-storage" checked>
                                            <label class="form-check-label" for="enable-storage">启用</label>
                                        </div>
                                    </div>
                                    <div class="part-fields">
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label class="required">配件名称</label>
                                                <input type="text" class="form-control" name="storage.PartName" 
                                                       placeholder="例如：500G 三星固态.m2" required>
                                                <div class="invalid-feedback">请输入配件名称</div>
                                            </div>
                                            <div class="form-group col-md-4">
                                                <label class="required">配件成本</label>
                                                <input type="number" step="0.01" class="form-control part-cost" name="storage.PartCost" 
                                                       placeholder="例如：190" required>
                                                <div class="invalid-feedback">请输入配件成本</div>
                                            </div>
                                            <div class="form-group col-md-2">
                                                <label>配件状态</label>
                                                <select class="form-control" name="storage.PartStatus">
                                                    <option value="1">正常</option>
                                                    <option value="2">异常</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label>第三方订单</label>
                                                <input type="text" class="form-control" name="storage.ThirdPartyOrder" 
                                                       placeholder="例如：TB123456789">
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label>购买平台</label>
                                                <select class="form-control" name="storage.PurchasePlatform">
                                                    <option value="1">咸鱼</option>
                                                    <option value="2">淘宝</option>
                                                    <option value="3">京东</option>
                                                    <option value="4">拼多多</option>
                                                    <option value="5">其他</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 电源 -->
                                <div class="part-section">
                                    <div class="part-header">
                                        <h4>电源</h4>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-power" checked>
                                            <label class="form-check-label" for="enable-power">启用</label>
                                        </div>
                                    </div>
                                    <div class="part-fields">
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label class="required">配件名称</label>
                                                <input type="text" class="form-control" name="power.PartName" 
                                                       placeholder="例如：骨伽 sxc 500" required>
                                                <div class="invalid-feedback">请输入配件名称</div>
                                            </div>
                                            <div class="form-group col-md-4">
                                                <label class="required">配件成本</label>
                                                <input type="number" step="0.01" class="form-control part-cost" name="power.PartCost" 
                                                       placeholder="例如：60" required>
                                                <div class="invalid-feedback">请输入配件成本</div>
                                            </div>
                                            <div class="form-group col-md-2">
                                                <label>配件状态</label>
                                                <select class="form-control" name="power.PartStatus">
                                                    <option value="1">正常</option>
                                                    <option value="2">异常</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label>第三方订单</label>
                                                <input type="text" class="form-control" name="power.ThirdPartyOrder" 
                                                       placeholder="例如：TB123456789">
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label>购买平台</label>
                                                <select class="form-control" name="power.PurchasePlatform">
                                                    <option value="1">咸鱼</option>
                                                    <option value="2">淘宝</option>
                                                    <option value="3">京东</option>
                                                    <option value="4">拼多多</option>
                                                    <option value="5">其他</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 机箱 -->
                                <div class="part-section">
                                    <div class="part-header">
                                        <h4>机箱</h4>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-case" checked>
                                            <label class="form-check-label" for="enable-case">启用</label>
                                        </div>
                                    </div>
                                    <div class="part-fields">
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label class="required">配件名称</label>
                                                <input type="text" class="form-control" name="case.PartName" 
                                                       placeholder="例如：黑色海景房" required>
                                                <div class="invalid-feedback">请输入配件名称</div>
                                            </div>
                                            <div class="form-group col-md-4">
                                                <label class="required">配件成本</label>
                                                <input type="number" step="0.01" class="form-control part-cost" name="case.PartCost" 
                                                       placeholder="例如：70" required>
                                                <div class="invalid-feedback">请输入配件成本</div>
                                            </div>
                                            <div class="form-group col-md-2">
                                                <label>配件状态</label>
                                                <select class="form-control" name="case.PartStatus">
                                                    <option value="1">正常</option>
                                                    <option value="2">异常</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label>第三方订单</label>
                                                <input type="text" class="form-control" name="case.ThirdPartyOrder" 
                                                       placeholder="例如：TB123456789">
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label>购买平台</label>
                                                <select class="form-control" name="case.PurchasePlatform">
                                                    <option value="1">咸鱼</option>
                                                    <option value="2">淘宝</option>
                                                    <option value="3">京东</option>
                                                    <option value="4">拼多多</option>
                                                    <option value="5">其他</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 散热器 -->
                                <div class="part-section">
                                    <div class="part-header">
                                        <h4>散热器</h4>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-cooler" checked>
                                            <label class="form-check-label" for="enable-cooler">启用</label>
                                        </div>
                                    </div>
                                    <div class="part-fields">
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label class="required">配件名称</label>
                                                <input type="text" class="form-control" name="cooler.PartName" 
                                                       placeholder="例如：乔思伯 cr 1400evo 黑色四铜管" required>
                                                <div class="invalid-feedback">请输入配件名称</div>
                                            </div>
                                            <div class="form-group col-md-4">
                                                <label class="required">配件成本</label>
                                                <input type="number" step="0.01" class="form-control part-cost" name="cooler.PartCost" 
                                                       placeholder="例如：45" required>
                                                <div class="invalid-feedback">请输入配件成本</div>
                                            </div>
                                            <div class="form-group col-md-2">
                                                <label>配件状态</label>
                                                <select class="form-control" name="cooler.PartStatus">
                                                    <option value="1">正常</option>
                                                    <option value="2">异常</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label>第三方订单</label>
                                                <input type="text" class="form-control" name="cooler.ThirdPartyOrder" 
                                                       placeholder="例如：TB123456789">
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label>购买平台</label>
                                                <select class="form-control" name="cooler.PurchasePlatform">
                                                    <option value="1">咸鱼</option>
                                                    <option value="2">淘宝</option>
                                                    <option value="3">京东</option>
                                                    <option value="4">拼多多</option>
                                                    <option value="5">其他</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 显卡 -->
                                <div class="part-section">
                                    <div class="part-header">
                                        <h4>显卡</h4>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-gpu" checked>
                                            <label class="form-check-label" for="enable-gpu">启用</label>
                                        </div>
                                    </div>
                                    <div class="part-fields">
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label class="required">配件名称</label>
                                                <input type="text" class="form-control" name="gpu.PartName" 
                                                       placeholder="例如：铭鑫显卡3060ti" required>
                                                <div class="invalid-feedback">请输入配件名称</div>
                                            </div>
                                            <div class="form-group col-md-4">
                                                <label class="required">配件成本</label>
                                                <input type="number" step="0.01" class="form-control part-cost" name="gpu.PartCost" 
                                                       placeholder="例如：1230" required>
                                                <div class="invalid-feedback">请输入配件成本</div>
                                            </div>
                                            <div class="form-group col-md-2">
                                                <label>配件状态</label>
                                                <select class="form-control" name="gpu.PartStatus">
                                                    <option value="1">正常</option>
                                                    <option value="2">异常</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label>第三方订单</label>
                                                <input type="text" class="form-control" name="gpu.ThirdPartyOrder" 
                                                       placeholder="例如：TB123456789">
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label>购买平台</label>
                                                <select class="form-control" name="gpu.PurchasePlatform">
                                                    <option value="1">咸鱼</option>
                                                    <option value="2">淘宝</option>
                                                    <option value="3">京东</option>
                                                    <option value="4">拼多多</option>
                                                    <option value="5">其他</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 总成本 -->
                    <div class="total-cost">
                        <div class="total-cost-label">总成本：</div>
                        <div class="total-cost-value" id="totalCost">¥0.00</div>
                    </div>
                    
                    <!-- 按钮组 -->
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save me-1"></i>
                            保存电脑信息
                        </button>
                        <a href="@Url.Action("Index", "Computer")" class="btn btn-secondary">
                            <i class="bi bi-arrow-left me-1"></i>
                            返回列表
                        </a>
                        <a href="@Url.Action("Create", "Computer")" class="btn btn-info">
                            <i class="bi bi-file-text me-1"></i>
                            文本解析方式
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="@Url.Content("~/Scripts/jquery-3.7.0.js")"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        $(document).ready(function () {
            // 初始化
            initializeApp();
        });
        
        // 初始化应用
        function initializeApp() {
            // 绑定事件
            bindEvents();
            
            // 计算初始总成本
            calculateTotalCost();
        }
        
        // 绑定事件
        function bindEvents() {
            // 表单提交事件
            $('#computerForm').submit(function (e) {
                e.preventDefault();
                submitForm();
            });
            
            // 表单输入事件 - 实时计算成本
            $(document).on('input change', '.part-cost', function() {
                calculateTotalCost();
            });
            
            // 配件启用/禁用事件
            $(document).on('change', 'input[type="checkbox"]', function() {
                var partSection = $(this).closest('.part-section');
                var partFields = partSection.find('.part-fields');
                var inputs = partFields.find('input, select');
                
                if ($(this).is(':checked')) {
                    // 启用配件，设置必填
                    inputs.prop('required', true);
                    partFields.find('.required').show();
                } else {
                    // 禁用配件，移除必填
                    inputs.prop('required', false);
                    partFields.find('.required').hide();
                }
                
                // 重新计算总成本
                calculateTotalCost();
            });
        }
        
        // 计算总成本
        function calculateTotalCost() {
            var totalCost = 0;
            
            // 遍历所有启用的配件成本输入框，计算总成本
            $('.part-section').each(function() {
                var section = $(this);
                var enabled = section.find('input[type="checkbox"]').is(':checked');
                
                if (enabled) {
                    var costInput = section.find('.part-cost');
                    var cost = parseFloat(costInput.val()) || 0;
                    totalCost += cost;
                }
            });
            
            // 更新总成本显示
            $('#totalCost').text('¥' + totalCost.toFixed(2));
        }
        
        // 表单验证
        function validateForm() {
            var isValid = true;
            
            // 重置验证状态
            resetFormValidation();
            
            // 验证电脑名称
            if ($('#ComputerName').val().trim() === '') {
                $('#ComputerName').addClass('is-invalid');
                isValid = false;
            }
            
            // 验证启用的配件
            $('.part-section').each(function() {
                var section = $(this);
                var enabled = section.find('input[type="checkbox"]').is(':checked');
                
                if (enabled) {
                    var partInputs = section.find('input, select[required]');
                    
                    partInputs.each(function() {
                        var input = $(this);
                        if (input.prop('required') && input.val().trim() === '') {
                            input.addClass('is-invalid');
                            isValid = false;
                        }
                        
                        // 验证配件成本
                        if (input.hasClass('part-cost')) {
                            var cost = parseFloat(input.val()) || 0;
                            if (cost <= 0) {
                                input.addClass('is-invalid');
                                isValid = false;
                            }
                        }
                    });
                }
            });
            
            return isValid;
        }
        
        // 重置表单验证
        function resetFormValidation() {
            $('.form-control').removeClass('is-invalid');
        }
        
        // 提交表单
        function submitForm() {
            // 表单验证
            if (!validateForm()) {
                return;
            }
            
            // 显示加载状态
            showLoading();
            
            // 定义配件类型映射
            var partTypeMap = {
                'motherboard': '主板',
                'cpu': 'CPU',
                'memory': '内存',
                'storage': '硬盘',
                'power': '电源',
                'case': '机箱',
                'cooler': '散热器',
                'gpu': '显卡'
            };
            
            // 收集表单数据
            var formData = {
                computerName: $('#ComputerName').val(),
                parts: []
            };
            
            // 收集所有启用的配件数据
            for (var key in partTypeMap) {
                if (partTypeMap.hasOwnProperty(key)) {
                    var checkbox = $('#enable-' + key);
                    if (checkbox.is(':checked')) {
                        var part = {
                            PartType: partTypeMap[key],
                            PartName: $('input[name="' + key + '.PartName"]').val(),
                            PartCost: parseFloat($('input[name="' + key + '.PartCost"]').val()),
                            PartStatus: parseInt($('select[name="' + key + '.PartStatus"]').val()),
                            ThirdPartyOrder: $('input[name="' + key + '.ThirdPartyOrder"]').val() || '',
                            PurchasePlatform: parseInt($('select[name="' + key + '.PurchasePlatform"]').val())
                        };
                        formData.parts.push(part);
                    }
                }
            }
            
            // 发送AJAX请求
            $.ajax({
                url: '@Url.Action("SaveForm", "Computer")',
                type: 'POST',
                data: JSON.stringify(formData),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (response) {
                    hideLoading();
                    
                    if (response.success) {
                        // 显示成功提示
                        showToast('电脑信息保存成功', 'success');
                        
                        // 清空表单
                        $('#computerForm')[0].reset();
                        
                        // 重新启用所有配件
                        $('input[type="checkbox"]').prop('checked', true);
                        
                        // 重置总成本
                        calculateTotalCost();
                        
                        // 重置表单验证状态
                        resetFormValidation();
                    } else {
                        // 显示失败提示
                        showToast('保存失败：' + response.message, 'error');
                    }
                },
                error: function (xhr, status, error) {
                    hideLoading();
                    
                    // 显示错误提示
                    var errorMessage = '保存失败，请稍后重试';
                    if (xhr.responseJSON && xhr.responseJSON.message) {
                        errorMessage = '保存失败：' + xhr.responseJSON.message;
                    }
                    showToast(errorMessage, 'error');
                }
            });
        }
        
        // 显示加载状态
        function showLoading() {
            $('#loadingOverlay').show();
        }
        
        // 隐藏加载状态
        function hideLoading() {
            $('#loadingOverlay').hide();
        }
        
        // 显示Toast提示
        function showToast(message, type = 'info') {
            // 创建Toast元素
            var toastHtml = `
                <div class="toast show bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : type === 'warning' ? 'warning' : 'info'} text-white">
                    <div class="toast-body d-flex align-items-center">
                        <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                        <span>${message}</span>
                        <button type="button" class="btn-close btn-close-white ms-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            // 添加到容器
            $('#toastContainer').append(toastHtml);
            
            // 3秒后自动关闭
            setTimeout(function() {
                $('.toast').fadeOut('slow', function() {
                    $(this).remove();
                });
            }, 3000);
        }
    </script>
</body>
</html>